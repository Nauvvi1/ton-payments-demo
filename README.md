# TON Payments Demo (Tonkeeper + Toncenter)

Демо-проект приёма платежей в TON **без KYC** с автоматической выдачей премиума пользователю.

Что делает:
- создаёт персональный платёж для пользователя
- принимает оплату через **Tonkeeper**
- проверяет транзакции через **Toncenter**
- автоматически выдаёт premium нужному пользователю

---

## Требования
- Node.js **18+**
- TON-кошелёк (адрес для приёма платежей)
- API-ключ **Toncenter** (через Telegram-бот `@toncenter`)

---

## Установка и запуск

```bash
npm install
cp .env.example .env
```

Отредактируй `.env`:
- `TON_RECEIVER_ADDRESS` — твой TON-адрес
- `TONCENTER_API_KEY` — ключ из `@toncenter`

Запуск:
```bash
npm start
```

Dev-режим:
```bash
npm run dev
```

---

## Как пользоваться

1. Открой в браузере  
   `http://localhost:3000`

2. Введи `userId` и нажми **Create gate**

3. Оплати через:
   - кнопку **Open in Tonkeeper**
   - или QR-код

4. После оплаты (5–15 сек):
   - премиум автоматически выдаётся пользователю
   - статус обновляется без ручного подтверждения

---

## Как это работает (коротко)

- Для пользователя создаётся заказ с уникальным `orderId`
- `orderId` передаётся в **comment/text** транзакции
- Poller читает входящие платежи через Toncenter
- Если `comment === orderId` и сумма ок → premium активируется

**Важно:** оплачивать нужно из кошелька, который сохраняет комментарий  
(**Tonkeeper — идеально**). Оплата с бирж/обменников может не передать comment.

---

## API (если нужен бэкенд)

- `POST /api/buy-premium` — создать платёж для пользователя  
- `GET /api/user/:userId` — проверить premium-статус  
- `GET /api/orders/:orderId` — статус заказа  

---

## Важно знать
- Хранилище сейчас **in-memory** (для демо)
- При перезапуске сервера заказы сбрасываются
- Для продакшена нужно заменить `store` на БД